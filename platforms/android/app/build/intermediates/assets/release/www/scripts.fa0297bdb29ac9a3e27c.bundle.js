!function(e,t){if("function"==typeof define&&define.amd)define(["module","./core/base64.js","./core/converter.js","./core/file.js","./core/image.js","./core/photo.js","./core/rotate.js"],t);else if("undefined"!=typeof exports)t(module,require("./core/base64.js"),require("./core/converter.js"),require("./core/file.js"),require("./core/image.js"),require("./core/photo.js"),require("./core/rotate.js"));else{var n={exports:{}};t(n,e.base64,e.converter,e.file,e.image,e.photo,e.rotate),e.compress=n.exports}}(this,function(e,t,n,r,i,a,o){"use strict";var u=h(t),s=h(n),f=h(r),l=h(i),c=h(a),d=h(o);function h(e){return e&&e.__esModule?e:{default:e}}var g=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),m=function(){function e(){!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this)}return g(e,[{key:"attach",value:function(e,t){var n=this;return new Promise(function(r,i){var a=document.querySelector(e);a.setAttribute("accept","image/*"),a.addEventListener("change",function(e){var i=n.compress([].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e.target.files)),t);r(i)},!1)})}},{key:"compress",value:function(e,t){return Promise.all(e.map(function(e){return function(e,t){var n=new c.default(t);n.start=window.performance.now(),n.alt=e.name,n.ext=e.type,n.startSize=e.size,Promise.resolve().then(d.default.orientation(e)).then(function(t){return console.log("orientation=",t),n.orientation=t,f.default.load(e)}).then(function(e){return function(t){return l.default.load(t).then(function(t){if(e.startWidth=t.naturalWidth,e.startHeight=t.naturalHeight,e.resize){var n=l.default.resize(e.maxWidth,e.maxHeight)(t.naturalWidth,t.naturalHeight),r=n.height;e.endWidth=n.width,e.endHeight=r}else e.endWidth=t.naturalWidth,e.endHeight=t.naturalHeight;return s.default.imageToCanvas(e.endWidth,e.endHeight,e.orientation)(t)}).then(function(t){return e.iterations=1,e.base64prefix=u.default.prefix(e.ext),function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments[5],f=s.default.canvasToBase64(t,r),l=u.default.size(f);return o+=1,l>i?e(t,l,r-.1,i,a,o):r>a?e(t,l,r-.1,i,a,o):f}(t,e.startSize,e.quality,e.size,e.minQuality,e.iterations)}).then(function(t){return e.finalSize=u.default.size(t),u.default.data(t)}).then(function(t){return e.end=window.performance.now(),{data:t,prefix:e.base64prefix,elapsedTimeInSeconds:(e.end-e.start)/1e3,alt:e.alt,initialSizeInMb:s.default.size(e.startSize).MB,endSizeInMb:s.default.size(e.finalSize).MB,ext:e.ext,quality:e.quality,endWidthInPx:e.endWidth,endHeightInPx:e.endHeight,initialWidthInPx:e.startWidth,initialHeightInPx:e.startHeight,sizeReducedInPercent:(e.startSize-e.finalSize)/e.startSize*100,iterations:e.iterations}})}}(n))}(e,t)}))}}],[{key:"convertBase64ToFile",value:function(e,t){return s.default.base64ToFile(e,t)}}]),e}();e.exports=m});